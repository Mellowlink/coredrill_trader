#:import utils kivy.utils
<DashboardLayout>

    balance_full:balance_full
    balance_available:balance_available

    asset_price:asset_price
    margin_ratio:margin_ratio

    amount_small:amount_small
    amount_medium:amount_medium
    amount_large:amount_large

    long_btn:long_btn
    short_btn:short_btn

    pending_tx_size:pending_tx_size
    pending_tx_margin:pending_tx_margin

    execute_btn:execute_btn

    pos_size:pos_size
    entry_price:entry_price
    liq_price:liq_price
    pos_margin:pos_margin
    pos_pnl:pos_pnl
    close_pos_btn:close_pos_btn

    GridLayout:
        cols: 1
        size: root.width, root.height

        # TODO: refactor GridLayouts with empty cols into appropriate Layout widgets

        # main background color
        canvas.before:
            Color:
                rgba: utils.get_color_from_hex('#181A20')
            Rectangle:
                pos: self.pos
                size: self.size
        GridLayout:
            cols: 6
            row_force_default: True
            row_default_height: 20

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size

            #TODO: Get rid of weird empty labels being used to balance the GridLayout
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: "Balance:"
                text_size: self.size
                halign: 'right'
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                id: balance_full
                text: "264.12 USDT"
                font_size: 14
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: "Available:"
                text_size: self.size
                halign: 'right'
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                id: balance_available
                text: "213.56 USDT"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
        GridLayout:
            cols: 2
            row_force_default: True
            row_default_height: 60
            size_hint_y: None
            height: self.minimum_height
            padding: -40

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                text: "ETH/USDT"
                text_size: self.size
                halign: 'center'
                valign: 'top'
                font_size: 18
                size_hint_x: 0.65
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#181A20')
                    Rectangle:
                        pos: self.pos
                        size: self.size
            Label:
                text: "Margin Ratio"
                text_size: self.size
                halign: 'center'
                valign: 'top'
                font_size: 16
                size_hint_x: 0.35
            Label:
                id: asset_price
                text: "3,957.66"
                text_size: self.size
                halign: 'center'
                valign: 'center'
                font_size: 36
                size_hint_x: 0.65
                color: utils.get_color_from_hex('#0ecb81')
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#181A20')
                    Rectangle:
                        pos: self.pos
                        size: self.size
            Label:
                id: margin_ratio
                text: "2.52%"
                text_size: self.size
                halign: 'center'
                valign: 'center'
                font_size: 24
                size_hint_x: 0.35
                color: utils.get_color_from_hex('#0ecb81')
            Label:
                text: ""
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#181A20')
                    Rectangle:
                        pos: self.pos
                        size: self.size
            Label:
                text: ""

        GridLayout:
            cols: 9
            row_force_default: True
            row_default_height: 50
            padding: 25
            # size_hint_y: None

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size

            #TODO: Get rid of weird empty labels being used to balance the GridLayout
            Label:
                text: ""
            Label:
                text: ""
            ToggleButton:
                id: amount_small
                text: "5%"
                group: "tx_amount"
                font_size: 28 if self.state == 'down' else 16
                color: (1,1,1,1) if self.state == 'down' else utils.get_color_from_hex('#f0b600')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#473601') if self.state == 'down' else (0,0,0,0)
                always_release: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#f0b600')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                on_press: root.change_tx_amount(self)
                on_release: setattr(self, 'state', 'down')
            Label:
                text: ""
            ToggleButton:
                id: amount_medium
                text: "10%"
                group: "tx_amount"
                font_size: 28 if self.state == 'down' else 16
                color: (1,1,1,1) if self.state == 'down' else utils.get_color_from_hex('#f0b600')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#473601') if self.state == 'down' else (0,0,0,0)
                always_release: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#f0b600')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                on_press: root.change_tx_amount(self)
                on_release: setattr(self, 'state', 'down')
            Label:
                text: ""
            ToggleButton:
                id: amount_large
                text: "15%"
                group: "tx_amount"
                font_size: 28 if self.state == 'down' else 16
                color: (1,1,1,1) if self.state == 'down' else utils.get_color_from_hex('#f0b600')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#473601') if self.state == 'down' else (0,0,0,0)
                always_release: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#f0b600')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                on_press: root.change_tx_amount(self)
                on_release: setattr(self, 'state', 'down')
            Label:
                text: ""
            Label:
                text: ""
        GridLayout:
            cols: 7
            row_force_default: True
            row_default_height: 50
            padding: 20
            # size_hint_y: None
            # height: self.minimum_height

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size

            #TODO: Get rid of weird empty labels being used to balance the GridLayout
            Label:
                text: ""
            Label:
                text: ""
            ToggleButton:
                id: long_btn
                text: "Buy/Long"
                group: "tx_direction"
                font_size: 16 if self.width > 80 else 12
                color: (1,1,1,1) if self.state == 'down' else utils.get_color_from_hex('#0ecb81')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#0ecb81') if self.state == 'down' else (0,0,0,0)
                always_release: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#0ecb81')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                #     Color:
                #         rgba: utils.get_color_from_hex('#0ecb81')
                #     RoundedRectangle:
                #         pos: self.pos
                #         size: self.size
                #         radius: [5]
                on_press: root.change_tx_direction(self)
                on_release: setattr(self, 'state', 'down')
            Label:
                text: ""
            ToggleButton:
                id: short_btn
                text: "Sell/Short"
                group: "tx_direction"
                font_size: 16 if self.width > 80 else 12
                color: (1,1,1,1) if self.state == 'down' else utils.get_color_from_hex('#f6465d')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#f6465d') if self.state == 'down' else (0,0,0,0)
                always_release: True
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#f6465d')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                #     Color:
                #         rgba: utils.get_color_from_hex('#f6465d')
                #     RoundedRectangle:
                #         pos: self.pos
                #         size: self.size
                #         radius: [5]
                on_press: root.change_tx_direction(self)
                on_release: setattr(self, 'state', 'down')
            Label:
                text: ""
            Label:
                text: ""
        GridLayout:
            cols: 4
            row_force_default: True
            row_default_height: 30
            padding: 20
            # size_hint_y: None
            # height: self.minimum_height

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size

            #TODO: Get rid of weird empty labels being used to balance the GridLayout
            Label:
                text: ""
            Label:
                text: "Size"
                font_size: 16
                color: utils.get_color_from_hex('#999999')
            Label:
                text: "Margin"
                font_size: 16
                color: utils.get_color_from_hex('#999999')
            Label:
                text: ""
            Label:
                text: ""
            Label:
                id: pending_tx_size
                text: "0.052 TEST"
                font_size: 18
            Label:
                id: pending_tx_margin
                text: "25.43 USDT"
                font_size: 18
            Label:
                text: ""

        GridLayout:
            cols: 7
            row_force_default: True
            row_default_height: 50
            padding: 20
            # size_hint_y: None
            # height: self.minimum_height

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#1E2026')
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""
            Button:
                id: execute_btn
                text: "Execute"
                font_size: 16
                #pos_hint: {'center_x': 0.5}
                on_release: root.execute_pressed()
            Label:
                text: ""
            Label:
                text: ""
            Label:
                text: ""

        GridLayout:
            cols: 6
            row_force_default: True
            row_default_height: 30
            # size_hint_y: None
            # height: self.minimum_height
            padding: 10

            #background color
            canvas.before:
                Color:
                    rgba: utils.get_color_from_hex('#181A20')
                Rectangle:
                    pos: self.pos
                    size: self.size
            Label:
                text: "Size"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                text: "Entry Price"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                text: "Liq. Price"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                text: "Margin"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            Label:
                text: "PNL(ROE %)"
                font_size: 14
                color: utils.get_color_from_hex('#999999')
            #TODO: Get rid of this empty label
            Label:
                text: ""
                font_size: 14

            Label:
                id: pos_size
                text: "0.138 TEST"
                color: utils.get_color_from_hex('#0ecb81')
                font_size: 14
            Label:
                id: entry_price
                text: "4,037.54"
                font_size: 14
            Label:
                id: liq_price
                text: "4,897.83"
                color: utils.get_color_from_hex('#f0b600')
                font_size: 14
            Label:
                id: pos_margin
                text: "56.01"
                font_size: 14
            Label:
                id: pos_pnl
                text: "-1.96(-2.98%)"
                color: utils.get_color_from_hex('#d70c25')
                font_size: 14
            Button:
                id: close_pos_btn
                text: "Close"
                font_size: 14
                color: utils.get_color_from_hex('#f0b600')
                background_normal: ''
                background_down: ''
                background_color: utils.get_color_from_hex('#473601') if self.state == 'down' else (0,0,0,0)
                canvas.before:
                    Color:
                        rgba: utils.get_color_from_hex('#f0b600')
                    Line:
                        width: 0.5
                        rectangle: self.x, self.y, self.width, self.height
                on_release: root.close_position()

</DashboardLayout>
